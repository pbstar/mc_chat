<template>
	<view>
		<TopBar path="/pages/friend/addfriend" text="查找用户"></TopBar>
		<view class="nouser" v-if="isno">
			<svg t="1623748393175" class="icon" viewBox="0 0 1123 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
				p-id="4419" width="60" height="60">
				<path
					d="M1006.797947 58.065168H131.503435c-34.947849 0-63.370782 28.422933-63.370782 63.370782v602.269587c0 34.914895 28.455887 63.370782 63.370782 63.370782h47.618711c2.883486 8.897614 8.172623 17.696365 16.09809 25.934896a15.709231 15.709231 0 0 0 7.134568 4.185174c79.37001 20.563374 99.076577 46.119298 103.756062 59.51515 5.190275 14.845833-3.394275 26.775226-3.938018 27.500217-5.107889 6.590825-3.954495 16.032182 2.553945 21.189502 6.590825 5.256183 16.081613 4.15222 21.337796-2.455082 7.183999-9.111816 17.185576-31.009832 8.979999-55.544178-11.270311-33.580253-51.869793-59.992984-120.628574-78.463771-5.717541-6.78855-7.447632-12.390751-7.447633-16.93842v-0.082385c0.032954-6.063559 3.855633-12.176549 10.743045-17.465687 0.214202-0.148294 0.461358-0.296587 0.642606-0.44488 1.977247-1.466459 4.185174-2.850532 6.623779-4.135743 0.576697-0.329541 1.153394-0.609651 1.730091-0.873284 2.91644-1.449981 6.261284-2.586899 9.556696-3.773248 5.289137-1.285211 14.812879-2.982348 29.971777-2.982348 26.561025 0 57.570856 5.223229 92.090302 15.389576 5.766972 2.520991 11.533944 5.140843 17.366824 8.238532 1.763046 0.939193 3.526091 1.944293 5.27266 2.965871 7.315816 4.102789 14.631631 8.601027 22.013355 13.659485 0.642605 0.461358 1.252257 0.757945 1.878385 1.219302 116.113859 81.528505 103.146411 122.67173 103.228797 122.67173-3.921541 7.414678-1.087486 16.608879 6.327192 20.53042 2.24088 1.186348 4.679486 1.763046 7.068659 1.763046 5.470385 0 10.726568-2.949394 13.428806-8.106715 4.761871-9.012953 20.645759-54.506123-75.66267-133.546591h268.658503c-96.341384 79.073423-80.49045 124.550115-75.728579 133.546591 2.801101 5.256183 8.287962 8.403302 13.939595 8.403302 2.273835 0 4.613577-0.543743 6.805026-1.697138 7.414678-3.921541 10.446458-12.687338 6.524917-20.102016-0.148294-0.395449-13.791301-41.538674 102.899255-123.462629 8.139669-5.717541 16.213429-10.627705 24.28719-15.125943 1.449981-0.823853 2.949394-1.664183 4.399376-2.455082 6.063559-3.213027 12.06121-5.94822 18.075337-8.568073 34.404106-10.116916 65.34803-15.323668 91.843146-15.323668 15.175375 0 24.68264 1.730092 29.905869 2.949394 3.344844 1.186348 6.772073 2.339743 9.655558 3.822679 0.576697 0.28011 1.087486 0.543743 1.647707 0.790899 2.537468 1.367596 4.943119 2.817578 6.969797 4.399375 0.098862 0.065908 0.181248 0.131816 0.28011 0.181248 6.95332 5.289137 10.775999 11.418604 10.808953 17.515118 0 0.098862 0.065908 0.148294 0.065908 0.247155-0.065908 4.498238-1.845431 10.051008-7.464109 16.790127-68.808213 18.470787-109.374741 44.883518-120.645051 78.463771-8.222054 24.534346 1.796 46.432362 8.979999 55.544178 5.223229 6.623779 14.763448 7.678311 21.321319 2.455082 6.590825-5.190275 7.678311-14.714017 2.455082-21.321319-0.098862-0.115339-9.012953-12.028256-3.970972-27.022382 4.498238-13.478237 24.023557-39.198932 103.871402-59.910599a14.990831 14.990831 0 0 0 7.134568-4.185174c7.958421-8.255008 13.264035-17.136145 16.131044-26.08319 34.27229-0.757945 61.953755-28.752474 61.953755-63.222488V121.43595c0.082385-34.947849-28.32407-63.370782-63.255443-63.370782zM229.327755 349.412586h135.128389c5.701064 20.069062 15.455485 71.082047-7.414678 135.474408l-1.631229 4.498238c-11.089063 30.812107-24.863887 69.170708 5.766972 148.425378 18.73442 48.360178 7.200476 75.909827-0.67556 87.625018 0-0.032954-0.032954-0.032954-0.065908-0.032954-1.367596-0.543743-2.702238-1.021578-4.03688-1.548844-18.124769-6.837981-35.623409-11.138494-52.16638-13.379374-1.433504-0.181248-2.850532-0.395449-4.284036-0.576697-7.777173-0.873284-15.307191-1.367596-22.590053-1.400551-1.631229 0-3.213027 0.098862-4.860733 0.148294-6.047082 0.148294-11.896439 0.576697-17.482163 1.285211-1.482936 0.181248-2.998825 0.296587-4.465284 0.510789-1.186348 0.181248-2.273835 0.477835-3.427229 0.675559 5.289137-25.143997 8.86466-62.299773-7.678311-87.180137-17.729319-26.775226-21.865062-109.259401-0.313065-171.52622 9.260109-26.841135-1.911339-75.316652-9.803852-102.998118z m596.782725 288.398024c30.663813-79.320579 16.823081-117.662703 5.701064-148.507764l-1.581798-4.399375c-22.870163-64.425314-13.082788-115.421822-7.381724-135.474408h135.111912c-7.925467 27.697942-19.096915 76.156983-9.803852 102.998118 21.502566 62.332727 17.399778 144.833379-0.296588 171.493266-16.575925 24.896841-13.000402 62.03614-7.711265 87.213091-1.186348-0.247156-2.273835-0.510789-3.493137-0.675559-0.972147-0.148294-2.010202-0.214202-3.03178-0.362496-6.277761-0.856807-12.90154-1.301688-19.772474-1.449981-0.906238-0.032954-1.779523-0.098862-2.702239-0.098863-25.391153-0.131816-54.110673 4.910165-84.346082 16.905466-7.892513-11.66576-19.426457-39.248363-0.692037-87.641495z m213.674546 85.894927c0 17.762273-14.087888 32.245611-31.668914 32.937648-2.043156-5.83288-5.256183-11.484513-9.737944-16.740696-0.642605-0.692037-1.40055-1.367596-2.043156-2.043155-0.247156-0.263633-0.510789-0.477835-0.724991-0.724991-2.24088-2.306789-4.761871-4.498238-7.530017-6.590825-0.856807-0.67556-1.763046-1.334642-2.669284-1.977248-2.158495-1.51589-4.498238-2.949394-6.953321-4.31699-1.038055-0.609651-1.911339-1.301688-2.998825-1.878385-0.329541-0.181248-0.757945-0.28011-1.087486-0.461358-0.032954-0.032954-0.065908-0.032954-0.098862-0.065908-5.766972-19.426457-14.335044-61.344103-1.07101-81.198964 25.259337-38.094968 26.989428-130.712536 3.70734-198.252015-6.277761-18.190677 3.493137-62.909424 12.7862-93.062449h5.94822c8.386825 0 15.175375-6.805027 15.175374-15.175375 0-8.386825-6.805027-15.175375-15.175374-15.175374H798.840942c-8.370348 0-15.175375 6.805027-15.175375 15.175374 0 5.882311 3.427229 10.841907 8.320917 13.362898-6.837981 27.055337-14.13732 80.473973 9.622604 147.453232l1.647706 4.580623c9.902715 27.417832 21.107117 58.510049-5.470384 127.186445-21.551998 55.659517-10.26521 91.942008 1.219302 111.368465-10.100439 5.355045-20.349172 11.484513-30.597905 18.45431l-0.032954 0.032955H419.143515c-0.972147-0.67556-1.944293-1.12044-2.949395-1.796-8.320917-5.585724-16.641833-10.594751-24.863887-15.060035-1.005101-0.543743-2.010202-1.219303-3.031779-1.763046 11.468035-19.459411 22.738346-55.708948 1.219302-111.28608-26.577502-68.561057-15.373099-99.62032-5.536293-127.071105l1.664184-4.646532c23.776401-66.979259 16.460585-120.364941 9.622604-147.420278 4.926642-2.520991 8.353871-7.464109 8.353871-13.362897 0-8.386825-6.805027-15.175375-15.175375-15.175375H191.677667c-8.386825 0-15.175375 6.805027-15.175374 15.175375 0 8.386825 6.805027 15.175375 15.175374 15.175374h5.94822c9.260109 30.153024 19.063961 74.888249 12.7862 93.062449-22.919594 66.287222-21.156548 160.750221 3.70734 198.252015 13.148696 19.772475 4.646532 61.75603-1.087487 81.198964-0.362495 0.214202-0.84033 0.329541-1.219302 0.510789-1.219303 0.626128-2.191449 1.40055-3.31189 2.026679-2.273835 1.301688-4.465284 2.619853-6.491962 4.03688-1.005101 0.692037-1.977247 1.433504-2.949395 2.158495-2.63633 2.026679-5.074935 4.15222-7.249907 6.409577-0.313064 0.296587-0.642605 0.609651-0.939193 0.906239-0.626128 0.642605-1.384073 1.285211-1.96077 1.944293-1.861908 2.158495-3.31189 4.43233-4.761871 6.689687-0.032954 0.098862-0.098862 0.148294-0.148294 0.214202-2.010202 3.213027-3.707339 6.524917-4.87721 9.902715h-47.618711c-18.223631 0-33.003556-14.796402-33.003556-33.003556V121.43595c0-18.190677 14.812879-33.003556 33.003556-33.003556h875.294512c18.190677 0 32.970602 14.812879 32.970602 33.003556v602.269587h0.016477z m0 0"
					fill="#F5881F" p-id="4420"></path>
				<path
					d="M537.003942 278.693034c0-8.370348-6.805027-15.175375-15.175374-15.175374-51.457866 0-95.105604-31.817208-116.080905-47.124399-4.827779-3.526091-8.617504-6.261284-11.237357-7.79365-7.23343-4.284036-16.526494-1.911339-20.794053 5.305614-4.284036 7.200476-1.911339 16.526494 5.289137 20.794053 2.026679 1.252257 5.041981 3.427229 8.86466 6.261283 23.562199 17.185576 72.597937 52.957279 133.958518 52.957279 8.386825-0.049431 15.175375-6.837981 15.175374-15.224806z m0 0M754.567075 208.583134c-2.586899 1.548844-6.409577 4.284036-11.270311 7.79365-20.958823 15.274237-64.590085 47.091444-116.047951 47.091445-8.386825 0-15.175375 6.805027-15.175374 15.175374 0 8.386825 6.78855 15.175375 15.175374 15.175375 61.360581 0 110.412795-35.738748 133.974995-52.924325 3.822678-2.784624 6.837981-5.041981 8.897614-6.261284 7.200476-4.284036 9.556696-13.610054 5.289137-20.794053-4.333467-7.200476-13.643008-9.573173-20.843484-5.256182z m0 0M677.536808 621.168777l-102.174264-45.855665a15.265998 15.265998 0 0 0-13.099265 0.296588l-90.36021 45.855664a15.180318 15.180318 0 0 0-6.673211 20.431558c3.75677 7.480586 12.90154 10.380549 20.398604 6.689687l83.901202-42.576729 95.534008 42.873316c2.010202 0.906238 4.15222 1.334642 6.228329 1.334642 5.766972 0 11.319742-3.31189 13.840733-8.963522 3.47666-7.62888 0.049431-16.625356-7.595926-20.085539z m0 0"
					fill="#F5881F" p-id="4421"></path>
			</svg>
			<text>您搜索的用户不存在!</text>
		</view>
		<view class="" v-if="!isno">
			<view class="topbox">
				<view class="tlbox">
					<image :src="userinfo.imgurl" mode=""></image>
				</view>
				<view class="trbox">
					<text>{{userinfo.name}}</text>
					<view class="idbox">
						<text>ID:{{seaid}}</text>
					</view>
				</view>
			</view>
			<view class="midbox">
				<cl-list-item label="性别">
					<cl-text :size="30" :value="getsex(userinfo.sex)"></cl-text>
				</cl-list-item>
				<cl-list-item label="年龄">
					<cl-text :size="30" :value="getage(userinfo.date)"></cl-text>
				</cl-list-item>
				<cl-list-item label="生日">
					<cl-text :size="30" :value="getbirth(userinfo.date)"></cl-text>
				</cl-list-item>
				<cl-list-item label="地区">
					<cl-text :size="30" :value="getarea(userinfo.area)"></cl-text>
				</cl-list-item>
			</view>
			<view class="botbox">
				<view class="" v-if="ismine">
					<cl-list-item label="二维码">
						<text slot="append" class="cl-icon-arrow-right"></text>
					</cl-list-item>
				</view>
				<view class="" v-if="isfriend">
					<button type="primary">发送消息</button>
				</view>
				<view class="" v-if="isuser">
					<button v-if="!isadd" type="primary" @click="add()">加为好友</button>
					<button v-if="isadd" @click="yesadd()">好友申请中</button>
				</view>
			</view>
		</view>
		<cl-toast ref="toast"></cl-toast>
	</view>
</template>

<script>
	import TopBar from "../../components/TopBar.vue";
	export default {
		components:{
			TopBar
		},
		data() {
			return {
				id:'',
				seaid: '',
				ismine:true,
				isfriend:false,
				isuser:false,
				isno:true,
				isadd:false,
				userinfo:{}
			}
		},
		onLoad: function(option) {
			this.seaid = option.seaid
			uni.getStorage({
				key: 'mc_chat_id',
				success: (res) => {
					this.id = res.data
				}
			})
			this.getuser(option.seaid)
			this.getbot(option.seaid)
		},
		methods: {
			getuser(id){
				uni.request({
					url: 'http://api.mcweb.top/mcchat/friend/search.php',
					method: 'GET',
					data: {
						id: id
					},
					success: (res) => {
						if (res.data.state == 101) {
							this.userinfo = res.data.body
							this.isno=false
						}
					}
				});
			},
			getsex(sex){
				if(sex=1){
					return '男'
				}else{
					return '女'
				}
			},
			getage(date){
				let myDate = new Date();
				let Year = myDate.getFullYear();
				return Year-date.substring(0,4)
			},
			getbirth(date){
				return date.substring(5).replace("-","月")+'日'
			},
			getarea(area){
				return area.replace(/-/g,"")
			},
			getbot(seaid){
				if(seaid==this.id){
					this.ismine=true
					this.isfriend=false
					this.isuser=false
					return
				}
				uni.request({
					url: 'http://api.mcweb.top/mcchat/friend/isfriend.php',
					method: 'GET',
					data: {
						mid: this.id,
						yid:seaid
					},
					success: (res) => {
						if (res.data.state == 101) {
							this.ismine=false
							this.isfriend=true
							this.isuser=false
						}else{
							uni.request({
								url: 'http://api.mcweb.top/mcchat/friend/isadd.php',
								method: 'GET',
								data: {
									mid: this.id,
									yid:seaid
								},
								success: (res) => {
									if (res.data.state == 101) {
										this.ismine=false
										this.isfriend=false
										this.isuser=true
										this.isadd=true
									}else{
										this.ismine=false
										this.isfriend=false
										this.isuser=true
										this.isadd=false
									}
								}
							});
						}
					}
				});
			},
			add(){
				uni.request({
					url: 'http://api.mcweb.top/mcchat/friend/add.php',
					method: 'GET',
					data: {
						mid: this.id,
						yid:this.seaid
					},
					success: (res) => {
						if (res.data.state == 101) {
							this.$refs["toast"].open({
								type:"error  ",
								position:"top",
							    message: "已申请，请等待通过",
							});
							this.ismine=false
							this.isfriend=false
							this.isuser=true
							this.isadd=true
						}
					}
				});
			},
			yesadd(){
				this.$refs["toast"].open({
					type:"warning  ",
					position:"top",
				    message: "已申请，请等待通过",
				});
			}
		}
	}
</script>

<style>
.nouser{
	display: flex;
	justify-content: center;
	flex-direction: column;
	align-items: center;
}
.nouser .icon{
	margin: 100px 0 40px 0;
}
.topbox {
		display: flex;
		padding: 40px 10px 10px 10px;
		background-color: #fff;
	}

	.tlbox image {
		width: 60px;
		height: 60px;
		border-radius: 10px;
	}

	.trbox {
		display: flex;
		justify-content: space-around;
		flex-direction: column;
		width: 100%;
		margin-left: 10px;
		font-size: 18px;
		font-weight: 800;
	}

	.idbox {
		display: flex;
		justify-content: space-between;
		font-size: 16px;
		font-weight: 400;
	}

	.idbox .icon {
		margin-left: 10px;
	}
/* 	.midbox{
		padding: 10px 20px;
	} */
</style>
